name: contractors-inn-parser

services:
    contractor-inn-parser:
        deploy:
          resources:
            limits:
              memory: 3500M
            reservations:
              memory: 2000M
        healthcheck:
          test: curl -sS 0.0.0.0:8000 || exit 1
          interval: 5s
          timeout: 10s
          retries: 3
        env_file:
          - ../.env
        build:
          context: ..
          dockerfile: build/Dockerfile.parser
        volumes:
            - .././:/app
        ports:
          - "8000:8000"
        command: gunicorn -w 2 --bind 0.0.0.0:8000 --timeout 1200 app:app

    health-checker:
          build:
            context: ..
            dockerfile: build/Dockerfile.health
          env_file:
            - ../.env
          depends_on:
            - contractor-inn-parser
          volumes:
            - .././:/app
